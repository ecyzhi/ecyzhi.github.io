<html>

<head>
    <title>BlackJack</title>

    <style>
        #BlackJackGame {
            border: 1px;
        }

        table {
            text-align: center;
        }

        #divBtnSave {
            text-align: center;
        }

        .gameBtn {
            width: 80px;
            height: 40px;
        }

        .BlackCard {
            color: black;
        }

        .RedCard {
            color: red;
        }

        #thDealerCard {
            height: 50px;
        }

        #thPlayerCard {
            height: 50px;
        }

        #btnHit {
            visibility: hidden;
        }

        #btnStand {
            visibility: hidden;
        }
    </style>

    <script>
        var cardNumber = ["A", "2", "3", "4", "5", "6", "7", "8", "9", "10", "J", "Q", "K"];
        var cardSuit = ["&spades;", "&hearts;", "&clubs;", "&diams;"];
        var dealerCard = [];
        var dealerCardNum = 0;
        var dealerCardValue = [];
        var playerCard = [];
        var playerCardNum = 0;
        var playerCardValue = [];

        var end = false;

        function deal() {
            var randomCard;

            dealCard("Dealer");
            dealCard("Dealer");
            dealCard("Player");
            dealCard("Player");

            document.getElementById("btnDeal").style.visibility = "hidden";

            calcValue();

            if (end == false) {
                document.getElementById("btnHit").style.visibility = "visible";
                document.getElementById("btnStand").style.visibility = "visible";
            }
        }

        function dealCard(who) {
            var cardValue = cardNumber[Math.floor(Math.random() * 13)];
            var randomCard = cardValue + " " + cardSuit[Math.floor(Math.random() * 4)];

            if (!isCardRepeat(randomCard)) {
                if (who == "Dealer") {
                    dealerCard.push(randomCard);
                    dealerCardValue.push(cardValue);
                    dealerCardNum++;

                    if (randomCard.includes("&spades;") || randomCard.includes("&clubs;")) {
                        document.getElementById("thDealerCard").innerHTML += '<span class="Card BlackCard">' + randomCard + '</span>';
                    }
                    else {
                        document.getElementById("thDealerCard").innerHTML += '<span class="Card RedCard">' + randomCard + '</span>';
                    }
                }
                else {
                    playerCard.push(randomCard);
                    playerCardValue.push(cardValue);
                    playerCardNum++;

                    if (randomCard.includes("&spades;") || randomCard.includes("&clubs;")) {
                        document.getElementById("thPlayerCard").innerHTML += '<span class="Card BlackCard">' + randomCard + '</span>';
                    }
                    else {
                        document.getElementById("thPlayerCard").innerHTML += '<span class="Card RedCard">' + randomCard + '</span>';
                    }
                }
            }
            else {
                dealCard(who);
            }
        }

        function isCardRepeat(card) {
            var repeat = false;

            if (dealerCard != null) {
                dealerCard.forEach(element => {
                    if (card == element) {
                        repeat = true;
                    }
                });
            }
            if (playerCard != null) {
                playerCard.forEach(element => {
                    if (card == element) {
                        repeat = true;
                    }
                });
            }
            return repeat;
        }

        function calcValue() {
            //Win if A+J/Q/K/10 or A+A
            if (dealerCardNum == 2) {
                if (((dealerCardValue[0] == "10" || dealerCardValue[0] == "J" || dealerCardValue[0] == "Q" || dealerCardValue[0] == "K") && (dealerCardValue[1] == "A"))
                    || (dealerCardValue[1] == "10" || dealerCardValue[1] == "J" || dealerCardValue[1] == "Q" || dealerCardValue[1] == "K") && (dealerCardValue[0] == "A")
                    || (dealerCardValue[0] == "A" && dealerCardValue[1] == "A")) {
                    document.getElementById("thDealerValue").innerText = "21";
                    end = true;
                }
            }

            if (playerCardNum == 2) {
                if (((playerCardValue[0] == "10" || playerCardValue[0] == "J" || playerCardValue[0] == "Q" || playerCardValue[0] == "K") && (playerCardValue[1] == "A"))
                    || (playerCardValue[1] == "J" || playerCardValue[1] == "J" || playerCardValue[1] == "Q" || playerCardValue[1] == "K") && (playerCardValue[0] == "A")
                    || (playerCardValue[0] == "A" && playerCardValue[1] == "A")) {
                    document.getElementById("thPlayerValue").innerText = "21";
                    end = true;
                }
            }


            var tempValue = 0;
            //Got logic error i think for "A" part
            if (end == false) {
                dealerCardValue.forEach(element => {
                    if (element == "J" || element == "Q" || element == "K" || element == "10") {
                        tempValue += 10;
                    }
                    else if (element == "A") {
                        if (dealerCardNum <= 2) {
                            tempValue += 11;
                        }
                        else {
                            if ((tempValue + 10) < 21) {
                                tempValue += 10;
                            }
                            else {
                                tempValue += 1;
                            }
                        }
                    }
                    else {
                        tempValue += parseInt(element);
                    }
                });
                document.getElementById("thDealerValue").innerText = tempValue;


                tempValue = 0;
                playerCardValue.forEach(element => {
                    if (element == "J" || element == "Q" || element == "K" || element == "10") {
                        tempValue += 10;
                    }
                    else if (element == "A") {
                        if (dealerCardNum <= 2) {
                            tempValue += 11;
                        }
                        else {
                            if ((tempValue + 10) < 21) {
                                tempValue += 10;
                            }
                            else {
                                tempValue += 1;
                            }
                        }
                    }
                    else {
                        tempValue += parseInt(element);
                    }
                });
                document.getElementById("thPlayerValue").innerText = tempValue;
            }
        }
    
        function hit(){
            dealCard("Player");
            calcValue();


            if(parseInt(document.getElementById("thDealerValue").innerText) <= 16 && dealerCardNum < 5){
                dealCard("Dealer");
                calcValue();
            }
        }

        function stand(){
            document.getElementById("btnHit").style.visibility = "Hidden";
            document.getElementById("btnStand").style.visibility = "Hidden";

            while((parseInt(document.getElementById("thDealerValue").innerText) <= 16) && dealerCardNum < 5){
                dealCard("Dealer");
                calcValue();
            }
        }
    </script>
</head>

<body>
    <h1>&spades; &hearts; BlackJack &clubs; &diams;</h1>

    <form method="post">
        <hr />

        <table id="BlackJackGame" align="center">
            <tr>
                <th colspan="3">Dealer's Card</th>
            </tr>
            <tr>
                <th id="thDealerCard" colspan="3"> </th>
            </tr>
            <tr>
                <th id="thDealerValue" colspan="3"> </th>
            </tr>

            <tr>
                <th><input type="button" id="btnHit" value="Hit" class="gameBtn" onclick="hit();" /></th>
                <th><input type="button" id="btnDeal" value="Deal" class="gameBtn" onclick="deal();" /></th>
                <th><input type="button" id="btnStand" value="Stand" class="gameBtn" onclick="stand();" /></th>
            </tr>

            <tr>
                <th id="thPlayerValue" colspan="3"> </th>
            </tr>
            <tr>
                <th id="thPlayerCard" colspan="3"> </th>
            </tr>
            <tr>
                <th colspan="3">Your Card</th>
            </tr>
        </table>

        <hr />
        
        <div id="divBtnSave">
            <input type="button" onclick="location.href='https://ecyzhi.github.io';" value="New Game" />
        </div>

    </form>
   
</body>

</html>
